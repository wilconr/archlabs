"use strict";var exist_modal=!1,curr_right_click_target=null,right_click_ele=null;const slackSecondaryClass="p-workspace__secondary_view",slackPrimaryClass="p-workspace__primary_view";var slackParentClass=slackPrimaryClass;function detectService(){var e=window.location.hostname,t=window.location.pathname;"mail.google.com"==e||"inbox.google.com"==e?sendBackgroundMessage({type:"observe_gmail"},(function(e){e&&"load_gmail"==e.type&&loadGmail()})):/[A-Z0-9._%-]+\.slack.com/i.test(e)?sendBackgroundMessage({type:"observe_slack"},(function(e){e&&("load_slack"==e.type&&loadSlack(),e.show_slack_popup&&firstSlackPopup())})):(/([A-Z0-9._%-]+\.|)send-anywhere.com/i.test(e)||"localhost"===e)&&addExtensionInfoOnWebsite(),/\.pdf$/i.test(t)&&sendBackgroundMessage({type:"observe_pdf"},(function(e){e&&"load_pdf"==e.type&&(refreshSocialToken(e.hostname),loadPdf())}))}function addExtensionInfoOnWebsite(){if(!document.getElementById("sa-extension-is-installed")){var e=document.createElement("div");e.id="sa-extension-is-installed",e.dataset.id=chrome.runtime.id,document.body.appendChild(e)}}function refreshSocialToken(e){const t="sa-refresh-iframe";function n(){var e=document.getElementById(t);e&&e.parentNode.removeChild(e)}var o,i,l;window.addEventListener("message",(function(e){document.getElementById(t)&&document.getElementById(t).contentWindow===e.source&&"remove_iframe"===e.data.action&&n()}),!1),n(),o=document.querySelector("html"),i=document.createElement("iframe"),l=(e||"https://chromeext.send-anywhere.com")+"/refresh-social-token",i.id=t,i.src=l,i.style.display="none",o.appendChild(i)}function loadPdf(){const e=$("html"),t=window.location.href,n=chrome.extension.getURL("/html/btn.html"),o=$(document.createElement("iframe")),i={padding:"0",margin:"0",position:"fixed",height:"48px",zIndex:"222222",top:"auto",left:"43px",bottom:"30px",border:"0 solid transparent",overflow:"hidden",overflowX:"hidden",overflowY:"hidden"};o.attr("id","sa-btn-iframe"),o.attr("src",n+"?data="+encodeURIComponent(t)),o.css(i),e.append(o);const l=function(e){"close_iframe"==e.data?closeIframe():"choose_pdf_options"==e.data?o.css({...i,height:"250px",width:"280px"}):"remove_option_menu"==e.data?o.css(i):"remove_btn"==e.data&&(window.removeEventListener("message",l,!1),o.remove())};window.addEventListener("message",l,!1)}function loadGmail(){var e=function(e){var t=chrome.extension.getURL("/img/ic_gmail.png");e.addButton({title:chrome.i18n.getMessage("gmail_hover_title"),iconUrl:t,onClick:function(t){sendBackgroundMessage({type:"click_gmail"}),loadEmbeddedWebapp("gmail",e)}})};InboxSDK.load("2","sdk_SAforGmail_008a3c87a3").then((function(t){t.Compose.registerComposeViewHandler(e)}))}function loadSlack(){let e=null;const t="div.ReactModalPortal",n=function(t){if(null===e)return;const n=$(t.target).find("div.c-menu__items");if(n.length){e.off("DOMNodeInserted"),e=null;const t=function(e){const t=$("<div/>");t.css({width:"100%",height:"28px",cursor:"pointer",display:"flex",padding:"0 24px"}),t.addClass("c-menu_item__li sa-menu_item");const n=chrome.extension.getURL("/img/ic_slack.svg"),o=chrome.extension.getURL("/img/ic_slack_hover.svg"),i=$('<img src="'+n+'"/>'),l=$('<img src="'+o+'"/>'),s={width:"28px",height:"28px",padding:"1px 0",margin:"0 12px 0 0",display:"none"};i.css(s),i.css({display:"block"}),l.css(s),t.append(i),t.append(l);const a=chrome.i18n.getMessage("sa"),d=$("<div>"+a+"</div>");d.css({flex:"1 1 auto",textOverflow:"ellipsis",overflow:"hidden",verticalAlign:"middle",lineHeight:"28px"}),t.append(d);let r=null;return t.hover((function(){if($(this).css({backgroundColor:"#1264a3"}),d.css({color:"#fff"}),i.css({display:"none"}),l.css({display:"block"}),r=e.find("div.c-menu_item__li.c-menu_item__li--highlighted"),r.length){r.removeClass("c-menu_item__li--highlighted");const e=r.find("button");e.length&&e.removeClass("c-menu_item__button--highlighted")}}),(function(){if($(this).css({backgroundColor:"transparent"}),d.css({color:"#1d1c1d"}),i.css({display:"block"}),l.css({display:"none"}),r&&r.length){r.addClass("c-menu_item__li--highlighted");const e=r.find("button");e.length&&e.addClass("c-menu_item__button--highlighted")}r=null})),t}(n);t.click((function(){const e=$(".ReactModal__Overlay.ReactModal__Overlay--after-open");e&&e.length&&setTimeout((function(){e.click()}),100),sendBackgroundMessage({type:"click_slack"}),loadEmbeddedWebapp("slack")})),n.append(t)}},o=function(o){e=$(o.target),$("body").off("DOMNodeInserted",t),$("body").on("DOMNodeRemoved",t,i),e.on("DOMNodeInserted",n)},i=function(n){$(n.target).is(t)&&(null!==e&&(e.off("DOMNodeInserted"),e=null),$("body").off("DOMNodeRemoved",t),l=!1)};let l=!1;$("body").on("click","button.c-button-unstyled.c-texty_input__button",(function(e){slackParentClass=$(this).parents().hasClass(slackSecondaryClass)?slackSecondaryClass:slackPrimaryClass,l||(l=!0,$("body").on("DOMNodeInserted",t,o))}))}function loadEmbeddedWebapp(e,t){var n,o;n=function(t){var n,i,l,s,a,d,r,c,p,m,u,f,y;l=function(n){if("gmail"===e&&t&&n)u=o(n),t.insertHTMLIntoBodyAtCursor(document.createElement("br")),t.insertHTMLIntoBodyAtCursor(document.createElement("br")),t.insertHTMLIntoBodyAtCursor(u),t.insertHTMLIntoBodyAtCursor(document.createElement("br"));else if("slack"==e&&n){const e=$("."+slackParentClass+" div.ql-editor");if(e.length){const t=e.find("p");if(t.length){const e=t.text();t.text(e+n.link+"\n")}e.focus()}}else if("editable"==e&&n&&right_click_ele){var i=right_click_ele.element;if("value"==right_click_ele.insert_type){var l=$(i).val();$(i).val(l+n.link)}else if("innerHTML"==right_click_ele.insert_type){l=$(i).text();$(i).text(l+n.link)}$(i).focus()}},n=function(){exist_modal&&(r(),s())},i=function(t){if(t.source===p.contentWindow||t.data){var o=t.data;"insert_link"===o.type?(l(o),y?d(!1):n(),e&&sendBackgroundMessage({type:"attach_files",service:e})):"close_modal"===o.type?n():"hide_modal"===o.type?d(!1):"check_transferring"===o.type&&(y=o.value,console.log("has_transfer_link",y))}},f=function(e){if(y){var t=e||window.event,n="The transfer is not complete, would you still like to leave the page?";return t&&(t.returnValue=n),n}},a=function(){exist_modal||(c=document.createElement("div"),m=document.createElement("div"),p=document.createElement("iframe"),c.id="sa-overlay",c.style.position="fixed",c.style.background="#FFF",c.style.zIndex="2147483640",c.style.opacity=".75",c.style.right="0",c.style.left="0",c.style.top="0",c.style.bottom="0",c.style.display="block",m.id="sa-content-wrap",m.style.position="fixed",m.style.zIndex="2147483641",m.style.right="0",m.style.left="0",m.style.top="50%",m.style.transform="translateY(-50%)",m.style.display="block",p.id="sa-selector",p.src=chrome.runtime.getURL("/html/embedded_webapp.html"),p.style.display="block",p.style.height="500px",p.style.width="400px",p.style.margin="0 auto",p.style.border="1px solid #d0d0d0",p.style.boxShadow="rgba(123, 137, 148, .1) 0px 0px 10px 2px",p.style.boxSizing="content-box",m.appendChild(p),document.body.appendChild(c),document.body.appendChild(m),exist_modal=!0)},s=function(){window.removeEventListener("message",i,!1),window.removeEventListener("beforeunload",f,!1)},d=function(e){var t,n;t={type:"change_modal_status",data:e},(n=document.getElementById("sa-selector"))&&n.contentWindow.postMessage(t,"*"),c=document.getElementById("sa-overlay"),m=document.getElementById("sa-content-wrap"),c.style.display=e?"block":"none",m.style.display=e?"block":"none"},r=function(){c=document.getElementById("sa-overlay"),m=document.getElementById("sa-content-wrap"),document.body.removeChild(c),document.body.removeChild(m),c=null,m=null,p=null,exist_modal=!1,y=!1},chrome.runtime.sendMessage(chrome.runtime.id,{type:"check_auth"},(function(e){e&&"auth_check_done"==e.type&&(exist_modal?d(!0):(a(),window.addEventListener("message",i,!1),window.addEventListener("beforeunload",f)))}))},o=function(e){if(e){var t,n,o,i,l,s=document.createElement("div"),a=document.createElement("table");return s.contentEditable=!1,a.style.borderTop="1px solid #ff2d55",a.style.width="412px",a.style.borderCollapse="collapse",t=document.createElement("tr"),(n=document.createElement("td")).innerHTML=chrome.i18n.getMessage("attachments_title"),n.style.fontSize="15px",n.style.fontWeight="700",n.style.color="#3f3f3f",n.style.padding="8px",t.appendChild(n),a.appendChild(t),e.summary&&(t=document.createElement("tr"),(n=document.createElement("td")).innerHTML=e.summary,n.style.fontSize="13px",n.style.color="#3f3f3f",n.style.width="324px",n.style.display="inline-block",n.style.padding="4px 0 4px 8px",n.style.textOverflow="ellipsis",n.style.overflow="hidden",n.style.whiteSpace="nowrap",t.appendChild(n),t.style.borderTop="1px solid #f0f0f0",a.appendChild(t),t=document.createElement("tr"),n=document.createElement("td"),i=document.createElement("span"),t.style.borderTop="1px solid #f0f0f0",n.style.padding="8px",e.file_number>1&&(i.innerHTML=chrome.i18n.getMessage("more_files",[e.file_number-1]),i.style.cssFloat="left",i.style.color="#3f3f3f",i.style.fontSize="13px"),n.appendChild(i),(i=document.createElement("span")).innerHTML=(e.file_number||0)+" Files"+(e.file_size&&!isNaN(e.file_size)?" | "+getFilesize(e.file_size):""),i.style.cssFloat="right",i.style.color="#3f3f3f",i.style.fontSize="13px",n.appendChild(i),t.appendChild(n),a.appendChild(t)),t=document.createElement("tr"),n=document.createElement("td"),o=document.createElement("a"),(i=document.createElement("span")).innerHTML=chrome.i18n.getMessage("download_link")+" ",i.style.color="#3f3f3f",i.style.fontSize="13px",i.style.fontWeight="700",i.style.display="block",n.appendChild(i),o.href=e.link,o.target="_blank",o.innerHTML=e.link,o.style.textDecoration="none",o.style.fontSize="13px",n.appendChild(o),e.expires_time&&((i=document.createElement("span")).innerHTML=" ("+computedExpTime(e.expires_time)+")",i.style.color="#3f3f3f",i.style.fontSize="13px",n.appendChild(i)),t.style.backgroundColor="#f0f0f0",n.style.padding="8px",t.appendChild(n),a.appendChild(t),t=document.createElement("tr"),n=document.createElement("td"),l=document.createElement("img"),n.style.padding="6px 8px 3px 8px",n.style.textAlign="right",o=document.createElement("a"),l.src="https://send-anywhere.com/assets/img/webapp/gmail_template_logo.png",l.alt="Send Anywhere",l.style.width="92px",l.style.height="18px",l.style.marginRight="6px",o.href="https://send-anywhere.com/file-transfer?utm_source=sa_app&utm_medium=extension_gmail&utm_campaign=tryitnow",o.target="_blank",o.innerHTML=chrome.i18n.getMessage("try_it_now"),o.style.color="#ff2d55",o.style.fontSize="13px",o.style.textDecoration="none",o.style.cssFloat="right",n.appendChild(l),n.appendChild(o),t.appendChild(n),a.appendChild(t),s.appendChild(a),s}},n(t)}function getFilesize(e){return e<=1024?e+" B":e<=1048576?Math.round(e/1024*100)/100+" KB":e<=1073741824?Math.round(e/1024/1024*100)/100+" MB":Math.round(e/1024/1024/1024*100)/100+"  GB"}function computedExpTime(e){if(!e)return"";var t=new Date(1e3*e),n=["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()].substring(0,3),o=t.getDate(),i=t.getHours(),l=i<12?"AM":"PM";return i>12&&(i-=12),"Exp. "+n+" "+o+", "+i+":"+addZero(t.getMinutes())+" "+l}function addZero(e){return e<10?"0"+e:e}function sendBackgroundMessage(e,t){chrome.runtime.sendMessage(chrome.runtime.id,e,(function(e){t&&t(e)}))}function holdRightClickElement(){right_click_ele={element:curr_right_click_target,insert_type:curr_right_click_target.is("textarea,input")?"value":"innerHTML"}}function firstSlackPopup(){var e,t,n,o,i;e=function(){var e=document.createElement("span"),t=document.createElement("div"),o=document.createElement("p"),l=document.createElement("p");e.style.borderLeft="solid transparent 5px",e.style.borderRight="solid transparent 5px",e.style.borderTop="solid rgba(33,33,33,.9) 5px",e.style.bottom="-5px",e.style.content=" ",e.style.height="0",e.style.right="13px",e.style.marginLeft="-13px",e.style.position="absolute",e.style.width="0",t.id="sa-popup",t.style.position="fixed",t.style.right="24px",t.style.bottom="70px",t.style.zIndex="200",t.style.backgroundColor="rgba(33,33,33,.9)",t.style.borderRadius="4px",t.style.padding="20px",t.style.maxWidth="330px",t.style.cursor="default",o.style.margin="0",o.style.marginBottom="5px",o.style.padding="0",o.style.color="#ff2d55",o.style.fontSize="15px",o.innerHTML=chrome.i18n.getMessage("sa"),l.style.margin="0",l.style.padding="0",l.style.fontSize="13px",l.style.color="#FFF",l.innerHTML=chrome.i18n.getMessage("slack_first_popup_desc"),t.appendChild(e),t.appendChild(o),t.appendChild(l),document.body.appendChild(t),n(),i()},t=function(e){(e=document.getElementById("sa-popup"))&&(document.body.removeChild(e),o())},n=function(){var e=document.getElementById("sa-popup");window.addEventListener("click",t),e.addEventListener("click",(function(e){e.stopPropagation()}))},i=function(){sendBackgroundMessage({type:"hidden_slack_popup"},(function(){}))},o=function(){window.removeEventListener("click",t)},setTimeout(e,8e3)}window.onerror=function(e,t,n,o,i){console.warn("Error: ",e,t,n,o,i)},chrome.runtime.onMessage.addListener((function(e,t,n){if(e&&e.type){if("load_embedded_webapp"===e.type&&"editable"===e.item)holdRightClickElement(),loadEmbeddedWebapp("editable",null),n();else{if("refresh_webapp"!==e.action)return!1;var o=document.getElementById("sa-selector");o&&o.contentWindow.postMessage(e,"*"),n(o?"OK!":"No thanks.")}return!0}})),$("body").bind("contextmenu",(function(e){var t=$(e.target);curr_right_click_target=t})),detectService(window.location.hostname);