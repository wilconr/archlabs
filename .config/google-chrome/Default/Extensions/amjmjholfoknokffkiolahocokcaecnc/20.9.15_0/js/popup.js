var options,background=chrome.extension.getBackgroundPage();function msgToBackground(e){chrome.runtime.sendMessage(chrome.runtime.id,e)}function msgToIframe(e){document.getElementById("webapp").contentWindow.postMessage(e,"*")}function getOptions(e){chrome.storage.sync.get("options",(function(o){o.options?e(o.options):e(null)}))}function saveOptions(e,o){chrome.storage.sync.set({options:e},(function(e){o(e)}))}function getParameter(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null}window.onload=function(){var e=chrome.runtime.getManifest().version,o=background.hostname;setTimeout((function(){o+="/web/app/v2/settings/?ver="+e;var t=document.createElement("iframe");t.id="webapp",t.src=o,document.body.appendChild(t),msgToBackground({type:"check_device"})}),1)},window.addEventListener("message",(function(e){if(e.data.type){var o=e.data;if("change_profile"==o.type)msgToBackground({type:o.type,data:o.data});else if("get_setting"==o.type)getOptions((function(e){e&&(options=e),msgToIframe({type:o.type,data:options})}));else if("set_setting"==o.type){if(o.data){var t=o.data;$.each(t,(function(e,o){options[e]=o,msgToBackground({type:"changed_options",item:e,data:o})})),saveOptions(options,(function(e){}))}}else"updated_session_cookie"===o.type?msgToBackground(o):"logout"===o.type&&(msgToBackground({type:"updated_session_cookie",data:"session_key"}),window.close())}}));