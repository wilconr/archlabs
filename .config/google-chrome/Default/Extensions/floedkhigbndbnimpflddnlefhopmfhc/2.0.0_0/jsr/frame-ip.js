var g_xReq=0,g_strHost="www.geoipview.com",g_strProtocal="http";document.addEventListener("DOMContentLoaded",function(){SendRequest();$("#search_btn").click(function(){IpSearch()})});function IpSearch(){var b=$("#f_ip").val();""!=b&&chrome.tabs.create({url:g_strProtocal+"://"+g_strHost+"/en/"+b+"/?ref=ext_whatip_"+g_strVer,selected:!0})}function OnTimeOut(){g_xReq.abort()}
function SendRequest(){g_xReq=new XMLHttpRequest;var b=window.setTimeout(function(){OnTimeOut(pi_strID,pi_iSortID)},2E4);try{g_xReq.onreadystatechange=function(){4==g_xReq.readyState&&(window.clearTimeout(b),RequestCallback(200==g_xReq.status?g_xReq.responseText:""))},g_xReq.onerror=function(){window.clearTimeout(b);RequestCallback("")},g_xReq.open("GET","http://api.geoipview.com/?t=3&ref=ext_whatip_"+g_strVer,!0),g_xReq.send(null)}catch(a){window.clearTimeout(b),RequestCallback("")}}
function RequestCallback(b){var a=0;""!=b&&(a=JSON.parse(b));a?($("#info_ip").html('<div class="info_detail"><a href="#" id="lnk_ip" title="Geo IP info: '+a.ip+'">'+a.ip+'</a> [<a href="#" id="lnk_whois" title="IP whois: '+a.ip+'">whois</a>]</div>'),$("#info_code").html('<div class="info_detail">'+a.code_info+' <img src="image/flags/'+a.code+'.png" class="icon_flag"></div>'),$("#info_country").html('<div class="info_detail">'+a.country+"</div>"),$("#info_city").html('<div class="info_detail"><a href="#" id="lnk_city" title="Geo IP info: '+
a.ip+'">'+a.city+"</a></div>"),$("#info_latitude").html('<div class="info_detail">'+a.latitude+"</div>"),$("#info_longitude").html('<div class="info_detail">'+a.longitude+"</div>"),$("#f_ip").val(a.ip),g_strHost=a.host,g_strProtocal=a.protocal,b=a.url,SetLinkActions({lnk_ip:{type:"link",sel:1,url:b},lnk_whois:{type:"link",sel:1,url:"http://whois.chromefans.org/"+a.ip},lnk_city:{type:"link",sel:1,url:b}})):($("#info_ip").html("N/A"),$("#info_code").html("N/A"),$("#info_country").html("N/A"),$("#info_city").html("N/A"),
$("#info_latitude").html("N/A"),$("#info_longitude").html("N/A"))}function SetLinkActions(b){for(var a in b){var c=b[a];SetLink(a,c.url,c.sel)}}function SetLink(b,a,c){$("#"+b).click(function(){chrome.tabs.create({url:a,selected:c?!0:!1})})};
